<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	template="/templates/modelo.xhtml">

	<ui:define name="conteudo">



		<h:form id="formOsListagem">
			<p:panel header="Ordens de Serviço">
				<p:dataTable id="tabelaOs" rows="5"
					emptyMessage="Nenhum registro encontrado."
					value="#{osBean.listaOs}" var="os" paginator="true" >

					<f:facet name="footer">
						<p:commandButton value="Nova OS" actionListener="#{osBean.novo}"
							oncomplete="PF('dlgOs').show();">
						</p:commandButton>
					</f:facet>

					<p:column headerText="Id" width="10%">
						<h:outputText value="#{os.codigo}" />
					</p:column>

					<p:column headerText="Data lançamento"
						sortBy="#{os.dataLancamento}" filterBy="#{os.dataLancamento}">
						<h:outputText value="#{os.dataLancamento}" />
					</p:column>

					<p:column headerText="Responsável">
						<h:outputText value="#{os.responsavelOS.nome}" />
					</p:column>

					<p:column headerText="Previsão Entrega">
						<h:outputText value="#{os.dataPrevisaoEntrega}" />
					</p:column>

					<p:column headerText="Valor Total">
						<h:outputText value="#{os.valorTotal}" />
					</p:column>

					<p:column styleClass="colunas" headerText="Opções" width="25%">

						<p:commandButton value="Editar" actionListener="#{osBean.editar}"
							oncomplete="PF('dlgOs').show();">
							<f:attribute name="osSelecionado" value="#{os}" />
							<f:actionListener
								type="org.omnifaces.eventlistener.ResetInputAjaxActionListener" />
						</p:commandButton>

					</p:column>

				</p:dataTable>
			</p:panel>
		</h:form>


		<p:dialog id="DlgMaster" widgetVar="dlgOs" draggable="false"
			showEffect="clip" hideEffect="clip"
			styleClass="ui-dialog-title-dialog" maximizable="true"
			minHeight="600" resizable="false" modal="true"
			header="Nova OS - Cadastro">
			<p:panel id="pnlMaster">
				<!-- inicio form itensProdutos -->
				<h:form id="formItensProdutos">

					<p:panel>
						<p:outputLabel value="Data Lançamento: " />
						<p:outputLabel value="#{osBean.os.dataLancamento}">
							<f:convertDateTime pattern="dd/MM/yyyy HH:mm" locale="pt_BR"
								timeZone="America/Sao_Paulo" />
						</p:outputLabel>
					</p:panel>
					<p:panel header="Itens de OS" styleClass="panel">
						<p:dataTable id="tabelaProdutos"
							emptyMessage="Nenhum registro encontrado."
							value="#{osBean.produtosOS}" var="produto" paginator="true">

							<p:column headerText="Id" width="10%">
								<h:outputText value="#{produto.codigo}" />
							</p:column>

							<p:column headerText="Retranca" sortBy="#{produto.descricao}"
								filterBy="#{produto.descricao}">
								<h:outputText value="#{produto.descricao}" />
							</p:column>

							<p:column headerText="Valor p/ hora">
								<h:outputText value="#{produto.valorPorHora}" />
							</p:column>

							<p:column headerText="Opções" width="25%">
								<p:commandButton value="adicionar"
									actionListener="#{osBean.adicionar}" update=":pnlMaster">
									<f:attribute name="produtoSelecionado" value="#{produto}" />
								</p:commandButton>

							</p:column>
						</p:dataTable>
					</p:panel>


					<p:panelGrid id="pnlGridFormItens" columns="2">
						<p:panel id="pnlFormItens" header="Itens para compor OS">
							<p:dataTable id="tabelaItens"
								emptyMessage="Nenhum registro encontrado."
								value="#{osBean.itensOs}" var="item" paginator="true">

								<p:column headerText="Id" width="10%">
									<h:outputText value="#{item.produtoOS.codigo}" />
								</p:column>
								<p:column headerText="Retranca"
									sortBy="#{item.produtoOS.descricao}"
									filterBy="#{item.produtoOS.descricao}">
									<h:outputText value="#{item.produtoOS.descricao}" />
								</p:column>
								<p:column headerText="valor p/ hora"
									sortBy="#{item.produtoOS.valorPorHora}"
									filterBy="#{item.produtoOS.valorPorHora}">
									<h:outputText value="#{item.produtoOS.valorPorHora}" />
								</p:column>
								<p:column headerText="quantidade" sortBy="#{item.quantidade}">
									<h:outputText value="#{item.quantidade}" />
								</p:column>
								<p:column headerText="valor parcial">
									<h:outputText style="font-weight:bold"
										value="#{item.valorParcial}" />
								</p:column>
								<p:column headerText="Ano Ref."
									sortBy="#{item.produtoOS.anoReferencia}"
									filterBy="#{item.produtoOS.anoReferencia}">
									<h:outputText value="#{item.produtoOS.anoReferencia}" />
								</p:column>
								<p:column headerText="Opções" width="25%">
									<p:commandButton value="remover"
										actionListener="#{osBean.remover}" update=":pnlMaster">
										<f:attribute name="itemSelecionado" value="#{item}" />

									</p:commandButton>
								</p:column>
							</p:dataTable>

						</p:panel>

						<p:panel header="Total">
							<h:panelGrid id="finalizacao" columns="3">
								<p:outputLabel style="font-weight:bold" value="R$ " />
								<h:outputText style="font-weight:bold;font-size:18px" 
									value="#{osBean.os.valorTotal}">
									<f:convertNumber locale="pt_BR" minFractionDigits="2" />
								</h:outputText>
								<p:commandButton value="Finalizar"
									actionListener="#{osBean.finalizar}"
									oncomplete="PF('dialogo').show();">
									<f:actionListener
										type="org.omnifaces.eventlistener.ResetInputAjaxActionListener" />

								</p:commandButton>
							</h:panelGrid>
						</p:panel>

					</p:panelGrid>

				<h:panelGrid columns="2">
					<p:commandButton value="Cancelar" onclick="PF('DlgMaster').hide();"/>
				</h:panelGrid>
				</h:form>
			</p:panel>
		</p:dialog>


	</ui:define>

</ui:composition>